---
title: "Raw Data Plots - LIS"
author: "Dave Bosworth & Amanda Maguire"
date: "9/02/2020"
output: 
  html_document: 
    code_folding: show
    toc: true
    toc_depth: 1
    toc_float: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Purpose

Create plots of the raw continuous water quality data for the LIS station. The data in these plots has been cleaned and formatted, but not inspected for suspect values. The purpose of these plots is to allow for us to visually inspect the data for suspect or unreliable values during the study period (2011-2019). The final QA/QC steps for this data can be found in the xxx.Rmd file.

# Global code and functions

```{r load packages, message = FALSE, warning = FALSE}
# Load packages
library(tidyverse)
library(lubridate)
```

```{r load functions, message = FALSE, warning = FALSE}
# Source global WQ functions
source("Water_Quality/global_wq_funcs.R")

# Source continuous WQ raw data plot functions
source("Water_Quality/Continuous_WQ/Plots_Raw_Data/rtm_raw_plots_funcs.R")
```

```{r define file paths}
# Define main NDFA file path for WQ subteam (assumes synced with SharePoint)
fp_fastr <- "California Department of Water Resources/Office of Water Quality and Estuarine Ecology - North Delta Flow Action/WQ_Subteam/"

# Define relative file path for processed continuous WQ data file for LIS
fp_rel_rtm_data <- paste0(fp_fastr, "Processed_Data/Continuous/RTM_OUTPUT_LIS_formatted.csv")

# Define absolute file path
fp_abs_rtm_data <- get_abs_path(fp_rel_rtm_data)
```

```{r set system tz as PST}
# Set System Timezone as "Etc/GMT+8" (PST) to make it consistent with the data 
Sys.setenv(TZ = "Etc/GMT+8")
```

# Import and Prepare Data

```{r import data}
# Import data
data_orig <- import_rtm_data(fp_abs_rtm_data, 7)
```

```{r prepare data, message = FALSE}
# Clean original data
data_clean <- data_orig %>% 
  # parse date-time variable and define tz as PST
  mutate(DateTime = ymd_hms(DateTime, tz = "Etc/GMT+8")) %>% 
  # pivot data longer for easier plotting
  select(-c(StationCode, ends_with("_Qual"))) %>% 
  pivot_longer(
    cols = -DateTime,
    names_to = "parameter",
    values_to = "value"
  ) %>% 
  # add yr and y-axis label variables
  mutate(yr = year(DateTime)) %>% 
  add_yaxis_var(parameter)
```

# Raw Data Plots {.tabset .tabset-pills}

## Chla {.tabset .tabset-pills}

```{r filter chla data, include = FALSE}
data_clean_chla <- data_clean %>% 
  filter(
    parameter == "Chla",
    yr >= 2013
  )
```

### All Years

```{r plot chla all years, echo = FALSE, warning = FALSE}
data_clean_chla %>% create_ts_plot(.$yaxis_lab[1])
```

### 2013

```{r plot chla 2013, echo = FALSE}
data_clean_chla %>% 
  filter(
    yr == 2013,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2014

```{r plot chla 2014, echo = FALSE}
data_clean_chla %>% 
  filter(
    yr == 2014,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2015

```{r plot chla 2015, echo = FALSE}
data_clean_chla %>% 
  filter(
    yr == 2015,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2016

```{r plot chla 2016, echo = FALSE}
data_clean_chla %>% 
  filter(
    yr == 2016,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2017

```{r plot chla 2017, echo = FALSE}
data_clean_chla %>% 
  filter(
    yr == 2017,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2018

```{r plot chla 2018, echo = FALSE}
data_clean_chla %>% 
  filter(
    yr == 2018,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2019

```{r plot chla 2019, echo = FALSE}
data_clean_chla %>% 
  filter(
    yr == 2019,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

## DO {.tabset .tabset-pills}

```{r filter do data, include = FALSE}
data_clean_do <- data_clean %>% 
  filter(
    parameter == "DO",
    yr >= 2013
  )
```

### All Years

```{r plot do all years, echo = FALSE, warning = FALSE}
data_clean_do %>% create_ts_plot(.$yaxis_lab[1])
```

### 2013

```{r plot do 2013, echo = FALSE}
data_clean_do %>% 
  filter(
    yr == 2013,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2014

```{r plot do 2014, echo = FALSE}
data_clean_do %>% 
  filter(
    yr == 2014,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2015

```{r plot do 2015, echo = FALSE}
data_clean_do %>% 
  filter(
    yr == 2015,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2016

```{r plot do 2016, echo = FALSE}
data_clean_do %>% 
  filter(
    yr == 2016,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2017

```{r plot do 2017, echo = FALSE}
data_clean_do %>% 
  filter(
    yr == 2017,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2018

```{r plot do 2018, echo = FALSE}
data_clean_do %>% 
  filter(
    yr == 2018,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2019

```{r plot do 2019, echo = FALSE}
data_clean_do %>% 
  filter(
    yr == 2019,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

## Flow {.tabset .tabset-pills}

```{r filter flow data, include = FALSE}
data_clean_flow <- data_clean %>% 
  filter(parameter == "Flow")
```

### All Years

```{r plot flow all years, echo = FALSE, warning = FALSE}
data_clean_flow %>% create_ts_plot(.$yaxis_lab[1])
```

### 2011

```{r plot flow 2011, echo = FALSE}
data_clean_flow %>% 
  filter(
    yr == 2011,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2012

```{r plot flow 2012, echo = FALSE}
data_clean_flow %>% 
  filter(
    yr == 2012,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2013

```{r plot flow 2013, echo = FALSE}
data_clean_flow %>% 
  filter(
    yr == 2013,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2014

```{r plot flow 2014, echo = FALSE}
data_clean_flow %>% 
  filter(
    yr == 2014,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2015

```{r plot flow 2015, echo = FALSE}
data_clean_flow %>% 
  filter(
    yr == 2015,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2016

```{r plot flow 2016, echo = FALSE}
data_clean_flow %>% 
  filter(
    yr == 2016,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2017

```{r plot flow 2017, echo = FALSE}
data_clean_flow %>% 
  filter(
    yr == 2017,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2018

```{r plot flow 2018, echo = FALSE}
data_clean_flow %>% 
  filter(
    yr == 2018,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2019

```{r plot flow 2019, echo = FALSE}
data_clean_flow %>% 
  filter(
    yr == 2019,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

## pH {.tabset .tabset-pills}

```{r filter pH data, include = FALSE}
data_clean_pH <- data_clean %>% 
  filter(
    parameter == "pH",
    yr >= 2013
  )
```

### All Years

```{r plot pH all years, echo = FALSE, warning = FALSE}
data_clean_pH %>% create_ts_plot(.$yaxis_lab[1])
```

### 2013

```{r plot pH 2013, echo = FALSE}
data_clean_pH %>% 
  filter(
    yr == 2013,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2014

```{r plot pH 2014, echo = FALSE}
data_clean_pH %>% 
  filter(
    yr == 2014,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2015

```{r plot pH 2015, echo = FALSE}
data_clean_pH %>% 
  filter(
    yr == 2015,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2016

```{r plot pH 2016, echo = FALSE}
data_clean_pH %>% 
  filter(
    yr == 2016,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2017

```{r plot pH 2017, echo = FALSE}
data_clean_pH %>% 
  filter(
    yr == 2017,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2018

```{r plot pH 2018, echo = FALSE}
data_clean_pH %>% 
  filter(
    yr == 2018,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2019

```{r plot pH 2019, echo = FALSE}
data_clean_pH %>% 
  filter(
    yr == 2019,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

## SpCnd {.tabset .tabset-pills}

```{r filter SpCnd data, include = FALSE}
data_clean_spcnd <- data_clean %>% 
  filter(
    parameter == "SpCnd",
    yr >= 2013
  )
```

### All Years

```{r plot SpCnd all years, echo = FALSE, warning = FALSE}
data_clean_spcnd %>% create_ts_plot(.$yaxis_lab[1])
```

### 2013

```{r plot SpCnd 2013, echo = FALSE}
data_clean_spcnd %>% 
  filter(
    yr == 2013,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2014

```{r plot SpCnd 2014, echo = FALSE}
data_clean_spcnd %>% 
  filter(
    yr == 2014,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2015

```{r plot SpCnd 2015, echo = FALSE}
data_clean_spcnd %>% 
  filter(
    yr == 2015,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2016

```{r plot SpCnd 2016, echo = FALSE}
data_clean_spcnd %>% 
  filter(
    yr == 2016,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2017

```{r plot SpCnd 2017, echo = FALSE}
data_clean_spcnd %>% 
  filter(
    yr == 2017,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2018

```{r plot SpCnd 2018, echo = FALSE}
data_clean_spcnd %>% 
  filter(
    yr == 2018,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2019

```{r plot SpCnd 2019, echo = FALSE}
data_clean_spcnd %>% 
  filter(
    yr == 2019,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

## Turbidity {.tabset .tabset-pills}

```{r filter turb data, include = FALSE}
data_clean_turb <- data_clean %>% 
  filter(
    parameter == "Turbidity",
    yr >= 2013
  )
```

### All Years

```{r plot turb all years, echo = FALSE, warning = FALSE}
data_clean_turb %>% filter(
  !is.na(value)
  ) %>%
  create_ts_plot(.$yaxis_lab[1])
```

### 2013

```{r plot turb 2013, echo = FALSE}
data_clean_turb %>% 
  filter(
    yr == 2013,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2014

```{r plot turb 2014, echo = FALSE}
data_clean_turb %>% 
  filter(
    yr == 2014,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2015

```{r plot turb 2015, echo = FALSE}
data_clean_turb %>% 
  filter(
    yr == 2015,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2016

```{r plot turb 2016, echo = FALSE}
data_clean_turb %>% 
  filter(
    yr == 2016,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2017

```{r plot turb 2017, echo = FALSE}
data_clean_turb %>% 
  filter(
    yr == 2017,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2018

```{r plot turb 2018, echo = FALSE}
data_clean_turb %>% 
  filter(
    yr == 2018,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2019

```{r plot turb 2019, echo = FALSE}
data_clean_turb %>% 
  filter(
    yr == 2019,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

## WaterTemp {.tabset .tabset-pills}

```{r filter wt data, include = FALSE}
data_clean_wt <- data_clean %>% 
  filter(
    parameter == "WaterTemp",
    yr >= 2013
  )
```

### All Years

```{r plot wt all years, echo = FALSE, warning = FALSE}
data_clean_wt %>% create_ts_plot(.$yaxis_lab[1])
```

### 2013

```{r plot wt 2013, echo = FALSE}
data_clean_wt %>% 
  filter(
    yr == 2013,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2014

```{r plot wt 2014, echo = FALSE}
data_clean_wt %>% 
  filter(
    yr == 2014,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2015

```{r plot wt 2015, echo = FALSE}
data_clean_wt %>% 
  filter(
    yr == 2015,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2016

```{r plot wt 2016, echo = FALSE}
data_clean_wt %>% 
  filter(
    yr == 2016,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2017

```{r plot wt 2017, echo = FALSE}
data_clean_wt %>% 
  filter(
    yr == 2017,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2018

```{r plot wt 2018, echo = FALSE}
data_clean_wt %>% 
  filter(
    yr == 2018,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```

### 2019

```{r plot wt 2019, echo = FALSE}
data_clean_wt %>% 
  filter(
    yr == 2019,
    !is.na(value)
  ) %>% 
  create_ts_plot(.$yaxis_lab[1])
```
