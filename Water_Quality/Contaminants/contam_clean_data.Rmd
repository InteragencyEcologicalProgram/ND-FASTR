---
title: "NDFA Contaminants Data: Cleaning"
author: "Dave Bosworth"
date: "8/31/2020"
output: 
  html_document: 
    code_folding: show
    toc: true
    toc_depth: 4
    toc_float: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Purpose

This document provides the code and decisions made to clean and standardize all contaminants data used for the North Delta Flow Action synthesis project. The data were collected by USGS, and includes concentration data for water, suspended sediment, and zooplankton samples.

# Global code and functions

```{r load packages, message = FALSE, warning = FALSE}
# Load packages
library(tidyverse)
library(readxl)
library(lubridate)
```

```{r load functions}
# Source global WQ functions
source("Water_Quality/global_wq_funcs.R")

# Source contaminants data cleaning functions
source("Water_Quality/Contaminants/contam_clean_data_funcs.R")
```

```{r define file paths}
# Define main NDFA file path for WQ subteam (assumes synced with SharePoint)
fp_fastr <- "California Department of Water Resources/Office of Water Quality and Estuarine Ecology - North Delta Flow Action/WQ_Subteam/"

# Define relative file paths for raw and processed contaminants data files
fp_rel_raw <- paste0(fp_fastr, "Raw_Data/Contaminants")
fp_rel_proc <- paste0(fp_fastr, "Processed_Data/Contaminants")

# Define absolute file paths
fp_abs_raw <- get_abs_path(fp_rel_raw)
fp_abs_proc <- get_abs_path(fp_rel_proc)

# Clean up
rm(fp_rel_raw, fp_rel_proc)

# Create a vector of object names to keep throughout the script
obj_keep <- append(objects(), "obj_keep")
```

# Water Data

## Import Data

```{r import raw water data}
# 2015-2018 data:
# Create a vector of all file paths for the raw USGS contaminants data downloaded from NWIS
nwis_fp <- dir(fp_abs_raw, pattern = "^CONTAM_RAW", full.names = T)

# Import the raw USGS contaminants data downloaded from NWIS into a nested dataframe
nwis_orig <-
  tibble(
    sta_code = str_sub(nwis_fp, start = 176, end = -15),
    df = map(nwis_fp, .f = import_nwis_data)
  )


# Import flow data for SDI
sdi_flow_orig <- read_excel(paste0(fp_abs_wq_raw, "/RTM_RAW_USGS_SDI Flow_2011-2018.xlsx"))


# Import water concentration data for 2015-2018


water_16_18_orig <- 
  read_excel(
    path = paste0(fp_abs_raw, "/PesticideResults_YoloDWR_2016_18Data_ForDWR.xlsx"),
    sheet =  "Water",
    col_types = c(
      "skip",
      "text",
      rep("skip", 2),
      rep("date", 2),
      rep("skip", 3),
      rep("text", 175),
      rep("skip", 5)
    ),
    n_max = 174
  )


```



